<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Kwiaciarnia Lilia</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .quiz-container {
            max-width: 700px;
            margin: 0 auto;
        }
        .quiz-step {
            text-align: center;
        }
        .quiz-step h2 {
            margin-bottom: 10px;
            font-size: 1.5rem;
            color: var(--color-text-primary, #fff);
        }
        .quiz-step .subtitle {
            color: var(--color-text-secondary, #888);
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 500px;
            margin: 0 auto;
        }
        .quiz-option {
            padding: 18px 24px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid var(--color-border);
            background: rgba(255,255,255,0.02);
            transition: all 0.2s;
            color: var(--color-text-primary, #fff);
        }
        .quiz-option:hover {
            background: rgba(255,255,255,0.08);
            border-color: var(--color-text-primary);
        }
        .quiz-option .icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }
        .quiz-option .text {
            flex: 1;
        }
        .quiz-option .text strong {
            display: block;
            margin-bottom: 3px;
            color: var(--color-text-primary, #fff);
        }
        .quiz-option .text small {
            color: var(--color-text-secondary, #888);
            font-size: 0.85rem;
        }
        .progress-bar {
            background: rgba(255,255,255,0.1);
            height: 6px;
            border-radius: 3px;
            margin-bottom: 40px;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #666, #999);
            height: 100%;
            transition: width 0.4s ease;
        }
        .step-indicator {
            text-align: center;
            color: #666;
            font-size: 13px;
            margin-bottom: 30px;
        }
        .back-btn {
            margin-top: 30px;
            opacity: 0.7;
        }

        /* Wyniki */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .result-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--color-border);
            border-radius: 4px;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .result-card:hover {
            transform: translateY(-5px);
        }
        .result-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .result-card .content {
            padding: 15px;
        }
        .result-card h4 {
            margin: 0 0 5px 0;
            font-size: 1rem;
        }
        .result-card .type {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
        }
        .result-card .button {
            width: 100%;
        }
        .no-results {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        .filters-summary {
            background: rgba(255,255,255,0.05);
            padding: 15px 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .filter-tag {
            background: rgba(255,255,255,0.1);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
        }

        /* Mobile styles for quiz */
        @media (max-width: 768px) {
            .quiz-container {
                padding: 0 10px;
            }
            .quiz-step h2 {
                font-size: 1.2rem;
            }
            .quiz-option {
                padding: 14px 16px;
            }
            .quiz-option .icon {
                font-size: 20px;
                width: 30px;
            }
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            .result-card img {
                height: 160px;
            }
            .result-card .content {
                padding: 12px;
            }
            .result-card h4 {
                font-size: 0.9rem;
            }
            .result-card .price {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            .quiz-container {
                padding: 0 5px;
            }
            .quiz-step h2 {
                font-size: 1.1rem;
            }
            .quiz-options {
                max-width: 100%;
            }
            .quiz-option {
                padding: 12px 14px;
                gap: 10px;
            }
            .quiz-option .text strong {
                font-size: 0.95rem;
            }
            .quiz-option .text small {
                font-size: 0.8rem;
            }
            .results-grid {
                grid-template-columns: 1fr;
            }
            .result-card img {
                height: 200px;
            }
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
            .button-group .button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Banner sezonowy -->
    <div class="seasonal-banner" id="seasonalBanner"></div>

    <header>
        <div class="container">
            <a href="index.html" class="logo">
                <img src="assets/images/branding/logo.png" alt="Kwiaciarnia Lilia">
            </a>
            <nav>
                <ul>
                    <li><a href="index.html">Strona g≈Ç√≥wna</a></li>
                    <li><a href="sklep.html">Sklep</a></li>
                    <li><a href="wyslij-kwiaty.html">Wy≈õlij kwiaty</a></li>
                    <li><a href="quiz.html">Quiz</a></li>
                    <li><a href="abonament.html">Abonament</a></li>
                    <li><a href="galeria.html">Galeria</a></li>
                    <li><a href="poradnik.html">Poradnik</a></li>
                    <li><a href="kwiatomat.html">Kwiatomat</a></li>
                    <li><a href="kontakt.html">Kontakt</a></li>
                    <li><a href="admin.html" style="color: #8B4513; font-weight: bold;">Admin</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="section">
        <div class="container">
            <div class="quiz-container">
                <h1 class="text-center mb-3">Znajd≈∫ idealny prezent w 30 sekund</h1>

                <!-- Pasek postƒôpu -->
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 20%;"></div>
                </div>
                <div class="step-indicator">Krok <span id="stepNumber">1</span> z 5</div>

                <!-- KROK 1: Okazja -->
                <div class="quiz-step" id="step1">
                    <h2>Z jakiej okazji szukasz prezentu?</h2>
                    <p class="subtitle">Pomaga nam ustaliƒá charakter kompozycji</p>

                    <div class="quiz-options">
                        <button class="quiz-option" onclick="answer(1, 'occasion', 'romantyczna')">
                            <span class="icon">üíï</span>
                            <span class="text">
                                <strong>Romantyczna</strong>
                                <small>Randka, rocznica, walentynki</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(1, 'occasion', 'uroczysta')">
                            <span class="icon">üéÇ</span>
                            <span class="text">
                                <strong>Uroczysta</strong>
                                <small>Urodziny, imieniny, ≈õlub</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(1, 'occasion', 'oficjalna')">
                            <span class="icon">üéÅ</span>
                            <span class="text">
                                <strong>Oficjalna / Podziƒôkowanie</strong>
                                <small>Dla szefowej, nauczyciela, lekarza</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(1, 'occasion', 'bezOkazji')">
                            <span class="icon">üå∏</span>
                            <span class="text">
                                <strong>Bez okazji</strong>
                                <small>Na poprawƒô humoru, po prostu tak</small>
                            </span>
                        </button>
                    </div>
                </div>

                <!-- KROK 2: Typ osobowo≈õci -->
                <div class="quiz-step" id="step2" style="display: none;">
                    <h2>Co najbardziej ucieszy≈Çoby obdarowywanƒÖ osobƒô?</h2>
                    <p class="subtitle">To pytanie pomo≈ºe wybraƒá rodzaj prezentu</p>

                    <div class="quiz-options">
                        <button class="quiz-option" onclick="answer(2, 'personality', 'klasyka')">
                            <span class="icon">üå∑</span>
                            <span class="text">
                                <strong>Klasyka i natura</strong>
                                <small>Kocha zapach ≈õwie≈ºych kwiat√≥w i tradycjƒô</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(2, 'personality', 'nowoczesnosc')">
                            <span class="icon">‚ú®</span>
                            <span class="text">
                                <strong>Nowoczesno≈õƒá i styl</strong>
                                <small>Lubi eleganckie dodatki do wnƒôtrz i design</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(2, 'personality', 'praktycznosc')">
                            <span class="icon">üç´</span>
                            <span class="text">
                                <strong>Praktyczno≈õƒá lub s≈Çodycz</strong>
                                <small>Woli prezenty do zjedzenia lub trwa≈Çe pamiƒÖtki</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(2, 'personality', 'obojetne')">
                            <span class="icon">ü§∑</span>
                            <span class="text">
                                <strong>Obojƒôtne</strong>
                                <small>Poka≈º wszystkie rodzaje</small>
                            </span>
                        </button>
                    </div>

                    <button class="button secondary back-btn" onclick="goBack(1)">‚Üê Cofnij</button>
                </div>

                <!-- KROK 3: Priorytet -->
                <div class="quiz-step" id="step3" style="display: none;">
                    <h2>Na czym najbardziej Ci zale≈ºy?</h2>
                    <p class="subtitle">Pomaga doprecyzowaƒá idealny wyb√≥r</p>

                    <div class="quiz-options">
                        <button class="quiz-option" onclick="answer(3, 'priority', 'wow')">
                            <span class="icon">ü§©</span>
                            <span class="text">
                                <strong>Efekt "WOW" i objƒôto≈õƒá</strong>
                                <small>Ma byƒá du≈ºo i piƒôknie</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(3, 'priority', 'trwalosc')">
                            <span class="icon">‚è≥</span>
                            <span class="text">
                                <strong>Trwa≈Ço≈õƒá</strong>
                                <small>Chcƒô, ≈ºeby prezent cieszy≈Ç tygodniami lub d≈Çu≈ºej</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(3, 'priority', 'symboliczny')">
                            <span class="icon">üíé</span>
                            <span class="text">
                                <strong>Symboliczny gest</strong>
                                <small>Co≈õ subtelnego, ale z klasƒÖ</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(3, 'priority', 'obojetne')">
                            <span class="icon">ü§∑</span>
                            <span class="text">
                                <strong>Obojƒôtne</strong>
                                <small>Nie mam preferencji</small>
                            </span>
                        </button>
                    </div>

                    <button class="button secondary back-btn" onclick="goBack(2)">‚Üê Cofnij</button>
                </div>

                <!-- KROK 4: Kolorystyka -->
                <div class="quiz-step" id="step4" style="display: none;">
                    <h2>W jakiej tonacji kolorystycznej?</h2>
                    <p class="subtitle">Pomaga dobraƒá idealnƒÖ kompozycjƒô</p>

                    <div class="quiz-options">
                        <button class="quiz-option" onclick="answer(4, 'color', 'czerwien')">
                            <span class="icon">‚ù§Ô∏è</span>
                            <span class="text">
                                <strong>Czerwie≈Ñ / Mi≈Ço≈õƒá</strong>
                                <small>Intensywne, namiƒôtne kolory</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(4, 'color', 'pastele')">
                            <span class="icon">üå∏</span>
                            <span class="text">
                                <strong>Jasne / Pastele / R√≥≈º</strong>
                                <small>Delikatne, subtelne odcienie</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(4, 'color', 'kolorowo')">
                            <span class="icon">üåà</span>
                            <span class="text">
                                <strong>Kolorowo / Mix</strong>
                                <small>Weso≈Çe, r√≥≈ºnorodne barwy</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(4, 'color', 'obojetne')">
                            <span class="icon">ü§∑</span>
                            <span class="text">
                                <strong>Obojƒôtne</strong>
                                <small>Dowolna kolorystyka</small>
                            </span>
                        </button>
                    </div>

                    <button class="button secondary back-btn" onclick="goBack(3)">‚Üê Cofnij</button>
                </div>

                <!-- KROK 5: Bud≈ºet -->
                <div class="quiz-step" id="step5" style="display: none;">
                    <h2>Ile chcesz przeznaczyƒá na prezent?</h2>
                    <p class="subtitle">Ostatni krok - zawƒôzimy wyb√≥r do najlepszych propozycji</p>

                    <div class="quiz-options">
                        <button class="quiz-option" onclick="answer(5, 'budget', 'maly')">
                            <span class="icon">üíµ</span>
                            <span class="text">
                                <strong>Drobny gest</strong>
                                <small>40 - 80 z≈Ç</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(5, 'budget', 'sredni')">
                            <span class="icon">üí∞</span>
                            <span class="text">
                                <strong>Z≈Çoty ≈õrodek</strong>
                                <small>80 - 150 z≈Ç</small>
                            </span>
                        </button>
                        <button class="quiz-option" onclick="answer(5, 'budget', 'duzy')">
                            <span class="icon">üíé</span>
                            <span class="text">
                                <strong>Prezent "na bogato"</strong>
                                <small>150 - 250 z≈Ç</small>
                            </span>
                        </button>
                    </div>

                    <button class="button secondary back-btn" onclick="goBack(4)">‚Üê Cofnij</button>
                </div>

                <!-- WYNIKI -->
                <div class="quiz-step" id="results" style="display: none;">
                    <h2>Oto nasze propozycje dla Ciebie!</h2>

                    <div class="filters-summary" id="filtersSummary">
                        <!-- Tagi bƒôdƒÖ wstawione dynamicznie -->
                    </div>

                    <div class="results-grid" id="resultsGrid">
                        <!-- Produkty bƒôdƒÖ wstawione dynamicznie -->
                    </div>

                    <div class="button-group mt-3" style="justify-content: center;">
                        <button class="button" onclick="restartQuiz()">Rozpocznij ponownie</button>
                        <a href="sklep.html" class="button secondary">Zobacz wszystkie produkty</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div style="display: flex; align-items: center; gap: 30px; flex-wrap: wrap;">
                <img src="assets/images/branding/logo.png" alt="Kwiaciarnia Lilia" style="height: 80px; width: auto;">
                <div style="flex: 1; text-align: left;">
                    <p style="margin-bottom: 5px;">Kwiaciarnia Lilia - Myszk√≥w ‚Ä¢ ul. Krasickiego 95F ‚Ä¢ Tel. +48 572 429 000</p>
                    <p style="margin: 0;">
                        <a href="polityka-prywatnosci.html" style="color: var(--color-text-secondary);">Polityka prywatno≈õci</a> ‚Ä¢
                        <a href="regulamin.html" style="color: var(--color-text-secondary);">Regulamin</a> ‚Ä¢
                        NIP 5732704306 ‚Ä¢ ¬© 2025 Lilia
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="assets/js/scripts.js"></script>
    <script src="assets/js/products.js"></script>
    <script>
        // Quiz odpowiedzi
        const answers = {
            occasion: null,
            personality: null,
            priority: null,
            budget: null,
            color: null
        };

        // Mapowania dla typ√≥w produkt√≥w (personality -> dozwolone typy)
        const personalityToTypes = {
            'klasyka': ['bukiet-zywy'],
            'nowoczesnosc': ['box-zywy', 'wieczna-roza'],
            'praktycznosc': ['bukiet-jadalny', 'wieczna-roza']
        };

        // Etykiety dla wy≈õwietlania
        const labels = {
            occasion: { romantyczna: 'Romantyczna', uroczysta: 'Uroczysta', oficjalna: 'Oficjalna', bezOkazji: 'Bez okazji' },
            personality: { klasyka: 'Klasyka', nowoczesnosc: 'Nowoczesno≈õƒá', praktycznosc: 'Praktyczno≈õƒá', obojetne: 'Dowolny typ' },
            priority: { wow: 'Efekt WOW', trwalosc: 'Trwa≈Ço≈õƒá', symboliczny: 'Symboliczny', obojetne: 'Dowolny priorytet' },
            budget: { maly: '40-80 z≈Ç', sredni: '80-150 z≈Ç', duzy: '150-250 z≈Ç' },
            color: { czerwien: 'Czerwie≈Ñ', pastele: 'Pastele', kolorowo: 'Kolorowo', obojetne: 'Dowolny kolor' }
        };

        // Pomocnicza funkcja - zwraca punkty za dopasowanie tagu
        // +2 = ma tag i pasuje (bonus)
        // -1 = ma tag i nie pasuje (kara)
        //  0 = brak tagu (neutralnie)
        // Mapowanie kategorii UI ‚Üí tagi w produktach (dla occasion)
        const occasionMapping = {
            'romantyczna': ['romantyczna', 'rocznica', 'przeprosiny'],
            'uroczysta': ['urodziny', 'gratulacje'],
            'oficjalna': ['podziekowanie', 'gratulacje'],
            'bezOkazji': ['bezOkazji']
        };

        function getTagScore(product, tagName, answerValue) {
            // Je≈õli u≈ºytkownik wybra≈Ç "obojƒôtne" - brak wp≈Çywu
            if (!answerValue || answerValue === 'obojetne') return 0;

            // Je≈õli produkt nie ma tego tagu - neutralnie
            if (!product.quizTags || !product.quizTags[tagName]) return 0;

            const tagValue = product.quizTags[tagName];
            const productTags = Array.isArray(tagValue) ? tagValue : [tagValue];

            let matches = false;

            // Dla occasion u≈ºywamy mapowania
            if (tagName === 'occasion' && occasionMapping[answerValue]) {
                const matchTags = occasionMapping[answerValue];
                matches = productTags.some(tag => matchTags.includes(tag));
            } else {
                matches = productTags.includes(answerValue);
            }

            return matches ? 2 : -1; // bonus za dopasowanie, kara za niedopasowanie
        }

        const typeLabels = {
            'box-zywy': 'Flower Box',
            'bukiet-zywy': 'Bukiet ≈ºywy',
            'bukiet-jadalny': 'Bukiet jadalny',
            'wieczna-roza': 'Wieczna r√≥≈ºa'
        };

        // Pobierz produkty
        let allProducts = [];

        document.addEventListener('DOMContentLoaded', function() {
            // Za≈Çaduj produkty z localStorage lub domy≈õlne
            const stored = localStorage.getItem('liliaProducts');
            if (stored) {
                allProducts = JSON.parse(stored);
            } else {
                allProducts = getProducts();
            }
            // Filtruj tylko okoliczno≈õciowe
            allProducts = allProducts.filter(p => p.category === 'occasional');
        });

        // Obs≈Çuga odpowiedzi
        function answer(step, key, value) {
            answers[key] = value;

            if (step < 5) {
                goToStep(step + 1);
            } else {
                showResults();
            }
        }

        // Przejd≈∫ do kroku
        function goToStep(step) {
            document.querySelectorAll('.quiz-step').forEach(el => el.style.display = 'none');
            document.getElementById('step' + step).style.display = 'block';
            document.getElementById('progressFill').style.width = (step * 20) + '%';
            document.getElementById('stepNumber').textContent = step;
        }

        // Cofnij
        function goBack(step) {
            goToStep(step);
        }

        // Poka≈º wyniki
        function showResults() {
            document.querySelectorAll('.quiz-step').forEach(el => el.style.display = 'none');
            document.getElementById('results').style.display = 'block';
            document.getElementById('progressFill').style.width = '100%';
            document.getElementById('stepNumber').textContent = '5';

            // Poka≈º podsumowanie filtr√≥w (pomijamy 'obojetne' bo to nie jest aktywny filtr)
            const summaryHtml = Object.entries(answers)
                .filter(([k, v]) => v && v !== 'obojetne')
                .map(([k, v]) => `<span class="filter-tag">${labels[k][v]}</span>`)
                .join('');
            document.getElementById('filtersSummary').innerHTML = summaryHtml;

            // Filtruj produkty
            let filtered = filterProducts();

            // Renderuj wyniki
            const grid = document.getElementById('resultsGrid');

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="no-results" style="grid-column: 1/-1;">
                        <p>Nie znale≈∫li≈õmy produkt√≥w pasujƒÖcych do wszystkich kryteri√≥w.</p>
                        <p>Spr√≥buj ponownie z innymi preferencjami lub <a href="sklep.html">zobacz wszystkie produkty</a>.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map((product) => `
                <div class="result-card">
                    <img src="${product.image}" alt="${product.name}" onerror="this.src='assets/images/branding/logo.png'">
                    <div class="content">
                        <div class="type">${typeLabels[product.type] || product.type}</div>
                        <h4>${product.name}</h4>
                        <div style="font-weight: bold; color: var(--color-accent); margin: 8px 0;">${product.price} z≈Ç</div>
                        <a href="sklep.html?product=${product.id}&delivery=1" class="button">üöö Zam√≥w z dostawƒÖ</a>
                        <a href="sklep.html?product=${product.id}" class="button secondary" style="margin-top: 8px;">Zam√≥w / Odbi√≥r</a>
                    </div>
                </div>
            `).join('');
        }

        // Filtrowanie produkt√≥w z systemem punktacji
        function filterProducts() {
            const budgetRanges = {
                'maly': [40, 80],
                'sredni': [80, 150],
                'duzy': [150, 250]
            };

            // Oblicz punktacjƒô dla ka≈ºdego produktu
            let scored = allProducts.map(product => {
                let score = 0;
                let budgetMatch = true;

                // 1. Bud≈ºet - TWARDY FILTR (musi pasowaƒá)
                if (answers.budget) {
                    const [min, max] = budgetRanges[answers.budget];
                    budgetMatch = product.price >= min && product.price <= max;
                }

                if (!budgetMatch) {
                    return { product, score: -100 }; // wyklucz z wynik√≥w
                }

                // 2. Personality -> typ produktu (+3 / -2 punkty)
                if (answers.personality && answers.personality !== 'obojetne') {
                    const allowedTypes = personalityToTypes[answers.personality] || [];
                    if (allowedTypes.length > 0 && allowedTypes.includes(product.type)) {
                        score += 3; // bonus za pasujƒÖcy typ
                    } else if (allowedTypes.length > 0) {
                        score -= 2; // kara za niepassujƒÖcy typ
                    }
                }

                // 3. Okazja (bonus/kara/neutralnie)
                score += getTagScore(product, 'occasion', answers.occasion);

                // 4. Priorytet (bonus/kara/neutralnie)
                if (answers.priority === 'trwalosc' && product.type === 'bukiet-zywy') {
                    score -= 3; // dodatkowa kara - bukiety ≈ºywe nie sƒÖ trwa≈Çe
                }
                score += getTagScore(product, 'priority', answers.priority);

                // 5. Kolorystyka (bonus/kara/neutralnie)
                score += getTagScore(product, 'color', answers.color);

                return { product, score };
            });

            // Odfiltruj produkty wykluczone przez bud≈ºet
            scored = scored.filter(s => s.score > -100);

            // Sortuj po punktacji (najlepsze dopasowanie na g√≥rze)
            scored.sort((a, b) => b.score - a.score);

            // Zwr√≥ƒá produkty (max 6)
            return scored.slice(0, 6).map(s => s.product);
        }

        // Restart
        function restartQuiz() {
            answers.occasion = null;
            answers.personality = null;
            answers.priority = null;
            answers.budget = null;
            answers.color = null;
            goToStep(1);
        }
    </script>
</body>
</html>
